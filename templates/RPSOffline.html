<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rock ‚Ä¢ Paper ‚Ä¢ Scissors</title>

<style>
  body {
    margin: 0;
    padding: 24px;
    font-family: system-ui, sans-serif;
    background: linear-gradient(to bottom right, #eef2ff, #f0f9ff, #ecfdf5);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  main {
    width: 100%;
    max-width: 850px;
  }

  h1 {
    font-size: 40px;
    font-weight: 900;
    text-align: center;
    margin-bottom: 8px;
    color: #0f172a;
  }

  header p {
    text-align: center;
    color: #475569;
    margin-bottom: 32px;
  }

  /* --- Utility boxes --- */
  .card {
    background: white;
    padding: 20px;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }

  .grid2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }

  .grid3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }

  /* --- Choice buttons --- */
  .choice {
    background: white;
    padding: 24px;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    transition: all 0.2s ease;
    text-align: center;
    cursor: pointer;
    user-select: none;
  }

  .choice:hover {
    box-shadow: 0 3px 12px rgba(0,0,0,0.12);
  }

  .choice.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .choice span:first-child {
    font-size: 48px;
    display: block;
  }

  /* --- Result Banner --- */
  #resultBanner {
    margin-bottom: 24px;
  }

  /* --- CPU Animation --- */
  #cpuAnim {
    margin-bottom: 24px;
    text-align: center;
  }

  #cpuAnim p {
    color: #64748b;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 1px;
  }

  #cpuGif {
    height: 100px;
    width: 100px;
    object-fit: contain;
  }

  #cpuEmoji {
    font-size: 48px;
  }

  /* --- History --- */
  #history li {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    padding: 8px;
    border-radius: 8px;
    font-size: 14px;
  }

  /* --- Buttons --- */
  #resetBtn {
    padding: 10px 16px;
    background: #6366f1;
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
  }
  #resetBtn:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  a.home-btn {
    display: block;
    text-align: center;
    padding: 10px 16px;
    background: #e2e8f0;
    color: #374151;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
  }

  /* Hidden helper */
  .hidden { display: none !important; }
</style>
</head>

<body>
<main>

  <!-- Header -->
  <header>
    <h1>Rock ‚Ä¢ Paper ‚Ä¢ Scissors</h1>
    <p>First to 3 wins! Choose your move below.</p>
  </header>

  <!-- Scoreboard -->
  <section class="grid2">
    <div class="card">
      <h2 style="font-size:12px; text-transform:uppercase; color:#64748b;">You</h2>
      <p id="playerScore" style="font-size:40px; font-weight:bold;">0</p>
    </div>
    <div class="card">
      <h2 style="font-size:12px; text-transform:uppercase; color:#64748b;">Computer</h2>
      <p id="cpuScore" style="font-size:40px; font-weight:bold;">0</p>
    </div>
  </section>

  <!-- CPU Animation -->
  <section id="cpuAnim" class="card hidden">
    <p>Computer is choosing‚Ä¶</p>
    <div style="display:flex; flex-direction:column; align-items:center; gap:12px;">
      <img id="cpuGif" alt="CPU animation" />
      <div id="cpuEmoji" class="hidden">‚úä</div>
    </div>
  </section>

  <!-- Result Banner -->
  <section id="resultBanner" class="card hidden">
    <p id="roundResult" style="font-size:18px; font-weight:600;"></p>
    <p id="roundDetail" style="color:#475569;"></p>
  </section>

  <!-- Choice Buttons -->
  <section class="grid3">
    <button class="choice" data-move="rock" onclick="mistyStart()">
      <span>‚úä</span>
      <span style="font-weight:600;">Rock</span>
      <span style="font-size:12px; color:#64748b;">Beats Scissors</span>
    </button>

    <button class="choice" data-move="paper" onclick="mistyStart()">
      <span>‚úã</span>
      <span style="font-weight:600;">Paper</span>
      <span style="font-size:12px; color:#64748b;">Beats Rock</span>
    </button>

    <button class="choice" data-move="scissors" onclick="mistyStart()">
      <span>‚úåÔ∏è</span>
      <span style="font-weight:600;">Scissors</span>
      <span style="font-size:12px; color:#64748b;">Beats Paper</span>
    </button>
  </section>

  <!-- History + Controls -->
  <section class="grid2">
    <div class="card">
      <div style="padding-bottom:10px; border-bottom:1px solid #e2e8f0;">
        <h3 style="font-weight:600;">Round History</h3>
        <p style="font-size:12px; color:#64748b;">Newest on top</p>
      </div>
      <ol id="history" style="max-height:256px; overflow:auto; padding:12px; list-style:none; margin:0;"></ol>
    </div>

    <div class="card" style="display:flex; flex-direction:column; gap:16px;">
      <div>
        <h3 style="font-weight:600;">Game Status</h3>
        <p id="gameStatus" style="color:#475569;">First to 3 ‚Äî make your move.</p>
      </div>
      <button id="resetBtn">Reset</button>
      <a class="home-btn" href="/">‚Üê Go Home</a>
    </div>
  </section>

</main>


<script>
/* Everything below is identical to your original JS. */
/* Only formatting changes were made ‚Äî NO logic changed. */

let player = 0;
let cpu = 0;

const playerEl = document.getElementById("playerScore");
const cpuEl = document.getElementById("cpuScore");
const historyEl = document.getElementById("history");
const gameStatusEl = document.getElementById("gameStatus");
const resultBanner = document.getElementById("resultBanner");
const roundResult = document.getElementById("roundResult");
const roundDetail = document.getElementById("roundDetail");
const resetBtn = document.getElementById("resetBtn");

const choices = ["rock", "paper", "scissors"];
const beats = { rock: "scissors", paper: "rock", scissors: "paper" };

function cpuPick() {
  return choices[Math.floor(Math.random() * choices.length)];
}

function updateScores() {
  playerEl.textContent = player;
  cpuEl.textContent = cpu;
}

function directSpeak(text) {
  fetch("http://127.0.0.1:5001/directSpeak", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });
}

function mistyStart() {
  fetch("http://127.0.0.1:5001/mistyStart", {
    method: "POST",
    headers: { "Content-Type": "application/json" }
  });
}

function banner(show, main = "", detail = "") {
  resultBanner.classList.toggle("hidden", !show);
  roundResult.textContent = main;
  roundDetail.textContent = detail;
}

function appendHistory(text) {
  const li = document.createElement("li");
  li.textContent = text;
  historyEl.prepend(li);
}

function isGameOver() {
  return player === 3 || cpu === 3;
}

function winnerText() {
  if (player > cpu) return "You win the game! üéâ";
  if (cpu > player) return "Computer wins the game! ü§ñ";
  return "It's a draw!";
}

function disableChoices(disabled) {
  document.querySelectorAll(".choice").forEach(btn => {
    btn.disabled = disabled;
    btn.classList.toggle("disabled", disabled);
  });
}

function sleep(ms) {
  return new Promise(r => setTimeout(r, ms));
}

async function showCpuAnimation(finalMove) {
  const cpuAnim = document.getElementById("cpuAnim");
  const cpuGif = document.getElementById("cpuGif");
  const cpuEmoji = document.getElementById("cpuEmoji");

  cpuAnim.classList.remove("hidden");
  cpuGif.classList.add("hidden");
  cpuEmoji.classList.remove("hidden");

  const cycle = ["‚úä", "‚úã", "‚úåÔ∏è", "‚úã", "‚úä", "‚úåÔ∏è"];
  for (const emo of cycle) {
    cpuEmoji.textContent = emo;
    await sleep(500);
  }

  cpuEmoji.textContent =
    finalMove === "rock" ? "‚úä" :
    finalMove === "paper" ? "‚úã" :
    "‚úåÔ∏è";

  directSpeak(cpuEmoji.textContent);

  await sleep(2500);
  cpuAnim.classList.add("hidden");
}

function fmt(move) {
  return move.charAt(0).toUpperCase() + move.slice(1);
}

async function playRound(playerMove) {
  if (isGameOver()) return;

  const c = cpuPick();
  disableChoices(true);
  await showCpuAnimation(c);

  if (playerMove === c) {
    banner(true, "Tie ü§ù", `${fmt(playerMove)} ties ${fmt(c)}.`);
    directSpeak("Tie");
    appendHistory(`Tie ‚Äî You: ${fmt(playerMove)} | CPU: ${fmt(c)}`);
  } else if (beats[playerMove] === c) {
    player++;
    banner(true, "You win this round! ‚úÖ", `${fmt(playerMove)} beats ${fmt(c)}.`);
    directSpeak("You win this round!");
    appendHistory(`Win ‚Äî ${fmt(playerMove)} beats ${fmt(c)}.`);
  } else {
    cpu++;
    banner(true, "You lose this round ‚ùå", `${fmt(c)} beats ${fmt(playerMove)}.`);
    directSpeak("You lose this round");
    appendHistory(`Loss ‚Äî ${fmt(c)} beats ${fmt(playerMove)}.`);
  }

  updateScores();

  if (isGameOver()) {
    gameStatusEl.textContent = winnerText();
    directSpeak(winnerText());
    directSpeak("Do you want to play again? Click reset");
  } else {
    gameStatusEl.textContent = "First to 3. Keep going!";
    disableChoices(false);
  }
}

function resetGame() {
  player = 0;
  cpu = 0;
  updateScores();
  historyEl.innerHTML = "";
  banner(false);
  disableChoices(false);
  gameStatusEl.textContent = "First to 3 ‚Äî make your move.";
}

document.querySelectorAll(".choice").forEach(btn => {
  btn.addEventListener("click", () => playRound(btn.dataset.move));
});

resetBtn.addEventListener("click", resetGame);

resetGame();
</script>
</body>
</html>
